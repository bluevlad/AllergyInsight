# 5. ê°œë°œ ê°€ì´ë“œ (Development Guide)

## 5.1 ê°œë°œ í™˜ê²½ ì„¤ì •

### í•„ìˆ˜ ìš”êµ¬ì‚¬í•­

| ë„êµ¬ | ìµœì†Œ ë²„ì „ | ê¶Œì¥ ë²„ì „ | ìš©ë„ |
|------|----------|----------|------|
| Git | 2.30+ | ìµœì‹  | ë²„ì „ ê´€ë¦¬ |
| Docker | 20.10+ | ìµœì‹  | ì»¨í…Œì´ë„ˆ |
| Docker Compose | 2.0+ | ìµœì‹  | ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ |
| Node.js | 18+ | 20 LTS | Frontend ê°œë°œ |
| Python | 3.11+ | 3.11 | Backend ê°œë°œ |
| VS Code | - | ìµœì‹  | IDE (ê¶Œì¥) |

### ì €ì¥ì†Œ í´ë¡ 

```bash
git clone https://github.com/bluevlad/AllergyInsight.git
cd AllergyInsight
```

### Dockerë¡œ ì‹¤í–‰ (ê¶Œì¥)

```bash
# ì „ì²´ ì„œë¹„ìŠ¤ ë¹Œë“œ ë° ì‹¤í–‰
docker-compose up -d --build

# ë¡œê·¸ í™•ì¸
docker-compose logs -f

# ì„œë¹„ìŠ¤ ì¤‘ì§€
docker-compose down
```

### ë¡œì»¬ ê°œë°œ í™˜ê²½ (Docker ì—†ì´)

#### Backend ì„¤ì •

```bash
cd backend

# ê°€ìƒ í™˜ê²½ ìƒì„±
python -m venv .venv

# ê°€ìƒ í™˜ê²½ í™œì„±í™”
# Windows
.venv\Scripts\activate
# macOS/Linux
source .venv/bin/activate

# ì˜ì¡´ì„± ì„¤ì¹˜
pip install -r requirements.txt

# í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
cp .env.example .env

# ì„œë²„ ì‹¤í–‰
uvicorn app.api.main:app --reload --port 9040
```

#### Frontend ì„¤ì •

```bash
cd frontend

# ì˜ì¡´ì„± ì„¤ì¹˜
npm install

# ê°œë°œ ì„œë²„ ì‹¤í–‰
npm run dev
```

### í™˜ê²½ ë³€ìˆ˜

#### Backend (.env)

```env
# Database
DATABASE_URL=postgresql://postgres:password@localhost:5432/allergyinsight

# JWT
JWT_SECRET_KEY=your-secret-key-change-in-production
JWT_ALGORITHM=HS256
JWT_EXPIRE_HOURS=24

# Google OAuth (ì„ íƒ)
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret

# Redis (ì„ íƒ)
REDIS_URL=redis://localhost:6379
```

#### Frontend (.env)

```env
VITE_API_URL=http://localhost:9040
```

---

## 5.2 ì½”ë”© ì»¨ë²¤ì…˜

### Python (Backend)

#### ìŠ¤íƒ€ì¼ ê°€ì´ë“œ
- **PEP 8** ì¤€ìˆ˜
- **Black** í¬ë§¤í„° ì‚¬ìš© (line-length=100)
- **isort**ë¡œ import ì •ë ¬
- **mypy**ë¡œ íƒ€ì… ì²´í¬

#### ë„¤ì´ë° ê·œì¹™

```python
# í´ë˜ìŠ¤: PascalCase
class UserDiagnosis:
    pass

# í•¨ìˆ˜/ë³€ìˆ˜: snake_case
def get_patient_by_id(patient_id: int) -> Patient:
    user_name = "í™ê¸¸ë™"
    return patient

# ìƒìˆ˜: UPPER_SNAKE_CASE
MAX_GRADE = 6
DEFAULT_PAGE_SIZE = 20

# Private: ì•ì— ì–¸ë”ìŠ¤ì½”ì–´
def _calculate_risk_level(grade: int) -> str:
    pass
```

#### íƒ€ì… íŒíŠ¸

```python
from typing import Optional, List
from datetime import datetime

def create_diagnosis(
    patient_id: int,
    results: List[dict],
    diagnosis_date: Optional[datetime] = None
) -> UserDiagnosis:
    """ì§„ë‹¨ ê²°ê³¼ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

    Args:
        patient_id: í™˜ì ID
        results: ì•ŒëŸ¬ì  ë³„ ë“±ê¸‰ ëª©ë¡
        diagnosis_date: ê²€ì‚¬ì¼ (ê¸°ë³¸ê°’: í˜„ì¬)

    Returns:
        ìƒì„±ëœ ì§„ë‹¨ ê°ì²´

    Raises:
        PatientNotFoundError: í™˜ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ëŠ” ê²½ìš°
    """
    pass
```

#### íŒŒì¼ êµ¬ì¡°

```python
# 1. Standard library imports
import os
from datetime import datetime
from typing import Optional, List

# 2. Third-party imports
from fastapi import APIRouter, Depends, HTTPException
from sqlalchemy.orm import Session

# 3. Local imports
from ..database.models import User, UserDiagnosis
from ..core.auth.dependencies import get_current_user
from .schemas import DiagnosisCreate, DiagnosisResponse
```

### JavaScript/React (Frontend)

#### ìŠ¤íƒ€ì¼ ê°€ì´ë“œ
- **ESLint** ê·œì¹™ ì¤€ìˆ˜
- **Prettier** í¬ë§¤í„° ì‚¬ìš©

#### ë„¤ì´ë° ê·œì¹™

```javascript
// ì»´í¬ë„ŒíŠ¸: PascalCase
function DiagnosisCard({ diagnosis }) { }

// í•¨ìˆ˜/ë³€ìˆ˜: camelCase
const patientName = "í™ê¸¸ë™";
function calculateRiskLevel(grade) { }

// ìƒìˆ˜: UPPER_SNAKE_CASE
const MAX_GRADE = 6;

// íŒŒì¼ëª…
// ì»´í¬ë„ŒíŠ¸: PascalCase.jsx
// ìœ í‹¸/ì„œë¹„ìŠ¤: camelCase.js
```

#### ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°

```jsx
/**
 * ì§„ë‹¨ ê²°ê³¼ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸
 */
import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { consumerApi } from '../services/consumerApi';

// Props ì •ì˜ (ì£¼ì„ìœ¼ë¡œ ì„¤ëª…)
function DiagnosisCard({ diagnosis, onSelect }) {
  // 1. Hooks
  const navigate = useNavigate();
  const [loading, setLoading] = useState(false);

  // 2. Effects
  useEffect(() => {
    // ...
  }, []);

  // 3. Handlers
  const handleClick = () => {
    onSelect(diagnosis.id);
  };

  // 4. Render
  return (
    <div className="diagnosis-card" onClick={handleClick}>
      {/* ... */}
    </div>
  );
}

export default DiagnosisCard;
```

---

## 5.3 Git ë¸Œëœì¹˜ ì „ëµ

### ë¸Œëœì¹˜ êµ¬ì¡°

```
main (production)
  â”‚
  â”œâ”€â”€ develop (development)
  â”‚     â”‚
  â”‚     â”œâ”€â”€ feature/add-emergency-guide
  â”‚     â”œâ”€â”€ feature/patient-management
  â”‚     â”‚
  â”‚     â”œâ”€â”€ fix/login-redirect-issue
  â”‚     â”‚
  â”‚     â””â”€â”€ refactor/api-structure
  â”‚
  â””â”€â”€ hotfix/critical-auth-bug
```

### ë¸Œëœì¹˜ ëª…ëª… ê·œì¹™

| ìœ í˜• | í˜•ì‹ | ì˜ˆì‹œ |
|------|------|------|
| ê¸°ëŠ¥ | `feature/{ê¸°ëŠ¥ëª…}` | `feature/add-emergency-guide` |
| ë²„ê·¸ ìˆ˜ì • | `fix/{ì´ìŠˆëª…}` | `fix/login-redirect-issue` |
| ë¦¬íŒ©í† ë§ | `refactor/{ëŒ€ìƒ}` | `refactor/api-structure` |
| ë¬¸ì„œ | `docs/{ë¬¸ì„œëª…}` | `docs/api-specification` |
| ê¸´ê¸‰ ìˆ˜ì • | `hotfix/{ì´ìŠˆëª…}` | `hotfix/critical-auth-bug` |

### ì»¤ë°‹ ë©”ì‹œì§€ ê·œì¹™

```
<type>(<scope>): <subject>

<body>

<footer>
```

#### Type

| Type | ì„¤ëª… |
|------|------|
| `feat` | ìƒˆë¡œìš´ ê¸°ëŠ¥ |
| `fix` | ë²„ê·¸ ìˆ˜ì • |
| `docs` | ë¬¸ì„œ ë³€ê²½ |
| `style` | ì½”ë“œ í¬ë§·íŒ… (ë¡œì§ ë³€ê²½ ì—†ìŒ) |
| `refactor` | ë¦¬íŒ©í† ë§ |
| `test` | í…ŒìŠ¤íŠ¸ ì¶”ê°€/ìˆ˜ì • |
| `chore` | ë¹Œë“œ, ì„¤ì • ë³€ê²½ |
| `ci` | CI/CD ê´€ë ¨ ë³€ê²½ |

#### ì˜ˆì‹œ

```
feat(consumer): ì‘ê¸‰ ëŒ€ì²˜ ê°€ì´ë“œ í˜ì´ì§€ ì¶”ê°€

- EmergencyPage ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
- ì¦ìƒë³„ ëŒ€ì²˜ë²• ì„¹ì…˜ ì¶”ê°€
- ì—í”¼íœ ì‚¬ìš©ë²• ì„¹ì…˜ ì¶”ê°€

Closes #123
```

### Pull Request ê·œì¹™

1. **ì œëª©**: `[Type] ê°„ëµí•œ ì„¤ëª…`
2. **ë³¸ë¬¸**: ë³€ê²½ ë‚´ìš©, í…ŒìŠ¤íŠ¸ ë°©ë²• í¬í•¨
3. **ë¦¬ë·°ì–´**: ìµœì†Œ 1ëª… ì§€ì •
4. **ì²´í¬ë¦¬ìŠ¤íŠ¸**:
   - [ ] í…ŒìŠ¤íŠ¸ í†µê³¼
   - [ ] ì½”ë“œ ë¦¬ë·° ì™„ë£Œ
   - [ ] ë¬¸ì„œ ì—…ë°ì´íŠ¸

---

## 5.4 ì½”ë“œ ë¦¬ë·° ê°€ì´ë“œ

### ë¦¬ë·° ì²´í¬ë¦¬ìŠ¤íŠ¸

#### ê¸°ëŠ¥ì„±
- [ ] ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±í•˜ëŠ”ê°€?
- [ ] ì—£ì§€ ì¼€ì´ìŠ¤ë¥¼ ì²˜ë¦¬í•˜ëŠ”ê°€?
- [ ] ì—ëŸ¬ ì²˜ë¦¬ê°€ ì ì ˆí•œê°€?

#### ê°€ë…ì„±
- [ ] ì½”ë“œê°€ ì´í•´í•˜ê¸° ì‰¬ìš´ê°€?
- [ ] ë„¤ì´ë°ì´ ëª…í™•í•œê°€?
- [ ] ë¶ˆí•„ìš”í•œ ë³µì¡ì„±ì´ ì—†ëŠ”ê°€?

#### ë³´ì•ˆ
- [ ] SQL Injection ë°©ì§€?
- [ ] XSS ë°©ì§€?
- [ ] ë¯¼ê° ì •ë³´ ë…¸ì¶œ ì—†ìŒ?
- [ ] ê¶Œí•œ ê²€ì‚¬ ì ì ˆ?

#### ì„±ëŠ¥
- [ ] N+1 ì¿¼ë¦¬ ì—†ìŒ?
- [ ] ë¶ˆí•„ìš”í•œ API í˜¸ì¶œ ì—†ìŒ?
- [ ] ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ê°€ëŠ¥ì„± ì—†ìŒ?

### ë¦¬ë·° ì½”ë©˜íŠ¸ ê·œì¹™

```
// í•„ìˆ˜ ìˆ˜ì •
[MUST] ì´ ë¶€ë¶„ì€ SQL Injection ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤. íŒŒë¼ë¯¸í„° ë°”ì¸ë”©ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”.

// ê¶Œì¥ ìˆ˜ì •
[SHOULD] ì´ í•¨ìˆ˜ê°€ ë„ˆë¬´ ê¸¸ì–´ìš”. ë¶„ë¦¬ë¥¼ ê³ ë ¤í•´ë³´ì„¸ìš”.

// ì„ íƒ ìˆ˜ì •
[COULD] ì—¬ê¸°ì— ì£¼ì„ì„ ì¶”ê°€í•˜ë©´ ì¢‹ì„ ê²ƒ ê°™ì•„ìš”.

// ì§ˆë¬¸
[QUESTION] ì´ ë¡œì§ì˜ ì˜ë„ê°€ ë­”ê°€ìš”?

// ì¹­ì°¬
[NICE] ê¹”ë”í•œ ì¶”ìƒí™”ë„¤ìš”! ğŸ‘
```

---

## 5.5 í…ŒìŠ¤íŠ¸ ì „ëµ

### í…ŒìŠ¤íŠ¸ í”¼ë¼ë¯¸ë“œ

```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    E2E    â”‚  â† ìµœì†Œ
        â”‚   Tests   â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚Integrationâ”‚  â† ì¤‘ê°„
        â”‚   Tests   â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚   Unit    â”‚  â† ìµœëŒ€
        â”‚   Tests   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Backend í…ŒìŠ¤íŠ¸

#### Unit Test

```python
# tests/unit/test_prescription_engine.py
import pytest
from app.services.prescription_engine import PrescriptionEngine

class TestPrescriptionEngine:
    def test_generate_prescription_high_grade(self):
        """ë“±ê¸‰ 4 ì´ìƒì€ high_riskë¡œ ë¶„ë¥˜ë˜ì–´ì•¼ í•¨"""
        engine = PrescriptionEngine()
        results = [{"allergen": "peanut", "grade": 4}]

        prescription = engine.generate_prescription(results)

        assert len(prescription.high_risk) == 1
        assert prescription.high_risk[0].allergen == "peanut"

    def test_cross_reactivity_included(self):
        """êµì°¨ë°˜ì‘ ì •ë³´ê°€ í¬í•¨ë˜ì–´ì•¼ í•¨"""
        engine = PrescriptionEngine()
        results = [{"allergen": "peanut", "grade": 4}]

        prescription = engine.generate_prescription(results)

        assert len(prescription.high_risk[0].cross_reactivity) > 0
```

#### Integration Test

```python
# tests/integration/test_diagnosis_api.py
import pytest
from fastapi.testclient import TestClient
from app.api.main import app

client = TestClient(app)

class TestDiagnosisAPI:
    def test_create_diagnosis(self, auth_headers):
        """ì§„ë‹¨ ìƒì„± API í…ŒìŠ¤íŠ¸"""
        response = client.post(
            "/api/pro/diagnosis",
            json={
                "patient_id": 1,
                "results": [{"allergen": "peanut", "grade": 4}]
            },
            headers=auth_headers
        )

        assert response.status_code == 201
        assert "diagnosis_id" in response.json()
```

### Frontend í…ŒìŠ¤íŠ¸

#### Component Test

```javascript
// src/apps/consumer/pages/EmergencyPage.test.jsx
import { render, screen } from '@testing-library/react';
import EmergencyPage from './EmergencyPage';

describe('EmergencyPage', () => {
  it('ì‘ê¸‰ ì—°ë½ì²˜ê°€ í‘œì‹œë˜ì–´ì•¼ í•¨', () => {
    render(<EmergencyPage />);

    expect(screen.getByText('119')).toBeInTheDocument();
    expect(screen.getByText('1339')).toBeInTheDocument();
  });
});
```

### í…ŒìŠ¤íŠ¸ ì‹¤í–‰

```bash
# Backend í…ŒìŠ¤íŠ¸
cd backend
pytest -v

# Frontend í…ŒìŠ¤íŠ¸
cd frontend
npm test
```

---

## 5.6 ë””ë²„ê¹…

### Backend ë¡œê·¸

```python
import logging

logger = logging.getLogger(__name__)

def create_diagnosis(data):
    logger.info(f"Creating diagnosis for patient: {data.patient_id}")
    try:
        # ...
        logger.debug(f"Prescription generated: {prescription}")
    except Exception as e:
        logger.error(f"Failed to create diagnosis: {e}", exc_info=True)
        raise
```

### Docker ë¡œê·¸ í™•ì¸

```bash
# ì „ì²´ ë¡œê·¸
docker-compose logs

# íŠ¹ì • ì„œë¹„ìŠ¤ ë¡œê·¸
docker-compose logs backend

# ì‹¤ì‹œê°„ ë¡œê·¸
docker-compose logs -f backend

# ìµœê·¼ 100ì¤„
docker-compose logs --tail=100 backend
```

### VS Code ë””ë²„ê¹…

#### Backend (Python)

```json
// .vscode/launch.json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "FastAPI",
      "type": "python",
      "request": "launch",
      "module": "uvicorn",
      "args": ["app.api.main:app", "--reload", "--port", "9040"],
      "cwd": "${workspaceFolder}/backend"
    }
  ]
}
```

#### Frontend (React)

```json
// .vscode/launch.json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Chrome",
      "type": "chrome",
      "request": "launch",
      "url": "http://localhost:4040",
      "webRoot": "${workspaceFolder}/frontend/src"
    }
  ]
}
```

---

## 5.7 ê°œë°œ ë„êµ¬

### ê¶Œì¥ VS Code í™•ì¥

| í™•ì¥ | ìš©ë„ |
|------|------|
| Python | Python ê°œë°œ |
| Pylance | Python íƒ€ì… ì²´í¬ |
| ESLint | JavaScript ë¦°íŒ… |
| Prettier | ì½”ë“œ í¬ë§·íŒ… |
| Docker | Docker ì§€ì› |
| GitLens | Git ê¸°ëŠ¥ ê°•í™” |
| REST Client | API í…ŒìŠ¤íŠ¸ |

### API í…ŒìŠ¤íŠ¸ ë„êµ¬

- **Swagger UI**: http://localhost:9040/docs
- **VS Code REST Client**: `.http` íŒŒì¼ ì‚¬ìš©
- **Postman** / **Insomnia**

### ë°ì´í„°ë² ì´ìŠ¤ ë„êµ¬

- **pgAdmin**: PostgreSQL GUI
- **DBeaver**: ë²”ìš© DB í´ë¼ì´ì–¸íŠ¸
- **VS Code PostgreSQL**: VS Code í™•ì¥

---

[â† API ëª…ì„¸](./4.-API-Specification) | [ë‹¤ìŒ: ë°°í¬ â†’](./6.-Deployment)
